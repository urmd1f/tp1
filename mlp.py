def set_hidden(info):
    # hidden_cnt : í•˜ë‚˜ì˜ ì€ë‹‰ê³„ì¸µì¸ ê²½ìš° í•´ë‹¹ ì€ë‹‰ê³„ì¸µì´ ê°–ëŠ” ë…¸ë“œì˜ ìˆ˜
	# hidden_config : ë‹¤ìˆ˜ì˜ ì€ë‹‰ê³„ì¸µì¸ ê²½ìš° í•´ë‹¹ ì€ë‹‰ê³„ì¸µë“¤ì˜ ìˆ˜ì™€ ë…¸ë“œì˜ ìˆ˜
    global hidden_cnt, hidden_config

    # ì€ë‹‰ê³„ì¸µ ì…‹íŒ… ê³¼ì •ì—ì„œ int í˜•ì‹ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ê²½ìš°ì™€ ë¦¬ìŠ¤íŠ¸ í˜•ì‹ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ê²½ìš°ë¥¼ ë¶„ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤. 
	# int í˜•ì‹ì€ í•˜ë‚˜ì˜ ì€ë‹‰ê³„ì¸µìœ¼ë¡œ ê³ ì •
    # list í˜•ì‹ì€ í•˜ë‚˜ ì´ìƒì˜ ì€ë‹‰ê³„ì¸µ 
    # isinstance() ëŠ” ì²« ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ íƒ€ì…ê³¼ ë‘ ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ íƒ€ì…ì´ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. 
    if isinstance(info, int):
        hidden_cnt = info      # int í˜•ì‹ì´ ë§ëŠ” ê²½ìš° hidden_cnt ë³€ìˆ˜ì— ì€ë‹‰ ê³„ì¸µì˜ ë…¸ë“œ ìˆ˜ë¥¼ í• ë‹¹ 
        hidden_config = None   # int í˜•ì‹ì´ ë§ëŠ” ê²½ìš° hidden_config ë³€ìˆ˜ëŠ” None ì²˜ë¦¬
    
	# ì‚¬ìš©ìì˜ ì„¤ì •ê°’ì´ list í˜•ì‹ì¸ ê²½ìš° í•´ë‹¹ info ì— ë‹´ê¸´ ê°’ì€ hidden_config ë³€ìˆ˜ì— í• ë‹¹
    else:
        hidden_config = info

# ê¸°ì¡´ì— íŒŒë¼ë¯¸í„°ë¥¼ ì´ˆê¸°í™” í•˜ëŠ” ë©”ì„œë“œì˜ ì¬ì •ì˜ ì…ë‹ˆë‹¤. 
def init_param():
    
	# ì‚¬ìš©ìê°€ ì •ì˜í•œ ì€ë‹‰ ê³„ì¸µì˜ ì •ë³´ì— ë”°ë¼ hidden_config ë³€ìˆ˜ì˜ íƒ€ì…ì€ None í˜¹ì€ Listë¡œ ì§€ì •ë©ë‹ˆë‹¤. 
	# hidden_config ë³€ìˆ˜ì˜ íƒ€ì…ì´ None ì´ ì•„ë‹Œ ê²½ìš° í•˜ë‚˜ ì´ìƒì˜ ì€ë‹‰ ê³„ì¸µì„ ê°–ìœ¼ë¯€ë¡œ, ê·¸ì— ë”°ë¥¸ íŒŒë¼ë¯¸í„° ì´ˆê¸°í™” ë©”ì„œë“œë¥¼ ë™ì‘ì‹œí‚µë‹ˆë‹¤. 
    if hidden_config is not None:
		# ì‚¬ìš©ìë¥¼ ìœ„í•œ ì€ë‹‰ê³„ì¸µ ì•ˆë‚´ ë¬¸êµ¬ ì¶œë ¥ ë° ë‹¤ìˆ˜ì˜ íŒŒë¼ë¯¸í„° ìƒì„±ì„ ìœ„í•œ ë©”ì„œë“œ ë™ì‘ 
        print(f"[ì•ˆë‚´] ì€ë‹‰ ê³„ì¸µ {len(hidden_config)}ê°œë¥¼ ê°–ëŠ” ë‹¤ì¸µ í¼ì…‰íŠ¸ë¡ ì´ ì ìš©ë©ë‹ˆë‹¤.")
        init_param_hiddens() # ë³¸ ë©”ì„œë“œëŠ” ê³§ ì •ì˜í•  ì˜ˆì •ì…ë‹ˆë‹¤. 
	
    # hidden_config ë³€ìˆ˜ì˜ íƒ€ì…ì´ None ì¸ ê²½ìš° í•˜ë‚˜ì˜ ì€ë‹‰ ê³„ì¸µì„ ê°–ìœ¼ë¯€ë¡œ, ê·¸ì— ë”°ë¥¸ íŒŒë¼ë¯¸í„° ì´ˆê¸°í™” ë©”ì„œë“œë¥¼ ë™ì‘ì‹œí‚µë‹ˆë‹¤. 
    else:
		# ì‚¬ìš©ìë¥¼ ìœ„í•œ ì€ë‹‰ê³„ì¸µ ì•ˆë‚´ ë¬¸êµ¬ ì¶œë ¥ ë° ë‹¤ìˆ˜ì˜ íŒŒë¼ë¯¸í„° ìƒì„±ì„ ìœ„í•œ ë©”ì„œë“œ ë™ì‘ 
        print("[ì•ˆë‚´] ì€ë‹‰ ê³„ì¸µ í•˜ë‚˜ë¥¼ ê°–ëŠ” ë‹¤ì¸µ í¼ì…‰íŠ¸ë¡ ì´ ì ìš©ë©ë‹ˆë‹¤.")
        init_param_hidden1() # ë³¸ ë©”ì„œë“œëŠ” ê³§ ì •ì˜í•  ì˜ˆì •ì…ë‹ˆë‹¤.


# # [í…ŒìŠ¤íŠ¸ ì½”ë“œ]
# # í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ê°„ë‹¨íˆ ë©”ì„œë“œì˜ ë™ì‘ í™•ì¸ë§Œ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ ì •ì˜í•˜ì˜€ìŠµë‹ˆë‹¤. 
# def init_param_hiddens():
#     print("init_param_hiddens() ê°€ ë™ì‘í•˜ì˜€ìŠµë‹ˆë‹¤.")

# def init_param_hidden1():
#     print("init_param_hidden1() ê°€ ë™ì‘í•˜ì˜€ìŠµë‹ˆë‹¤.")

# # í•˜ë‚˜ ì´ìƒì˜ ì€ë‹‰ê³„ì¸µì„ ì„¤ì •í•˜ëŠ” ê²½ìš°
# set_hidden([5,3])
# init_param()

# # í•˜ë‚˜ì˜ ì€ë‹‰ê³„ì¸µë§Œì„ ì„¤ì •í•˜ëŠ” ê²½ìš°
# set_hidden(5)
# init_param()

# ê¸°ì¡´ì— ì‹ ê²½ë§ì˜ ì„ í˜•ì—°ì‚°ì„ ìˆ˜í–‰í•˜ëŠ” ë©”ì„œë“œë¥¼ ì¬ì •ì˜ í•©ë‹ˆë‹¤. 
# ì„ í˜•ì—°ì‚°ì— í•„ìš”í•œ ë…ë¦½ë³€ìˆ˜ê°€ ë‹´ê¸´ ë³€ìˆ˜ë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ì·¨í•©ë‹ˆë‹¤. 
def forward_neuralnet(x):
    # ì‚¬ìš©ìê°€ ì •ì˜í•œ ì€ë‹‰ ê³„ì¸µì— ë”°ë¼ hidden_config ë³€ìˆ˜ì˜ íƒ€ì…ì€ None í˜¹ì€ Listë¡œ ì§€ì •ë©ë‹ˆë‹¤. 
    # hidden_config ë³€ìˆ˜ì˜ íƒ€ì…ì´ None ì´ ì•„ë‹Œ ê²½ìš° í•˜ë‚˜ ì´ìƒì˜ ì€ë‹‰ ê³„ì¸µì„ ê°–ìœ¼ë¯€ë¡œ, ê·¸ì— ë”°ë¥¸ ì„ í˜•ì—°ì‚° ë©”ì„œë“œë¥¼ ë™ì‘ì‹œí‚µë‹ˆë‹¤. 
    if hidden_config is not None:
        return forward_neuralnet_hiddens(x)
    
    # hidden_config ë³€ìˆ˜ì˜ íƒ€ì…ì´ None ì¸ ê²½ìš° í•˜ë‚˜ì˜ ì€ë‹‰ ê³„ì¸µì„ ê°–ìœ¼ë¯€ë¡œ, ê·¸ì— ë”°ë¥¸ ì„ í˜•ì—°ì‚° ë©”ì„œë“œë¥¼ ë™ì‘ì‹œí‚µë‹ˆë‹¤. 
    else:
        return forward_neuralnet_hidden1(x)

# ê¸°ì¡´ì— ê²½ì‚¬í•˜ê°•ë²•ì— ë”°ë¥¸ íŒŒë¼ë¯¸í„° ì—…ë°ì´íŠ¸ ë©”ì„œë“œë¥¼ ì¬ì •ì˜ í•©ë‹ˆë‹¤. 
# ìœ„ ë°©ì‹ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ hidden_config ë³€ìˆ˜íƒ€ì…ì— ë§ì¶° ë™ì‘í•˜ëŠ” ë©”ì„œë“œë¥¼ ë‹¬ë¦¬í•©ë‹ˆë‹¤. 
# ë§¤ê°œë³€ìˆ˜ëŠ” ê²½ì‚¬í•˜ê°•ë²•ì— í•„ìš”í•œ ë³€ìˆ˜ë“¤ì„ ì·¨í•©ë‹ˆë‹¤. 
def backprop_neuralnet(G_output, hiddens):
    if hidden_config is not None:
        backprop_neuralnet_hiddens(G_output, hiddens)
    else:
        backprop_neuralnet_hidden1(G_output, hiddens)

# # [í…ŒìŠ¤íŠ¸ ì½”ë“œ]
# # ë©”ì„œë“œ ë™ì‘ í…ŒìŠ¤íŠ¸ì— í•„ìš”í•œ ë‚´ë¶€ ë©”ì„œë“œëŠ” ì‚¬ì „ì— ê°„ë‹¨íˆ ì •ì˜í•©ë‹ˆë‹¤.
# def forward_neuralnet_hidden1(x):
#     print("forward_neuralnet_hidden1() ë©”ì„œë“œê°€ ë™ì‘í•˜ì˜€ìŠµë‹ˆë‹¤.")

# def forward_neuralnet_hiddens(x):
#     print("forward_neuralnet_hiddens() ë©”ì„œë“œê°€ ë™ì‘í•˜ì˜€ìŠµë‹ˆë‹¤.")

# def backprop_neuralnet_hidden1(G_output, hiddens):
#     print("backprop_neuralnet_hidden1() ë©”ì„œë“œê°€ ë™ì‘í•˜ì˜€ìŠµë‹ˆë‹¤.")

# def backprop_neuralnet_hiddens(G_output, hiddens):
#     print("backprop_neuralnet_hiddens() ë©”ì„œë“œê°€ ë™ì‘í•˜ì˜€ìŠµë‹ˆë‹¤.")


# # ì€ë‹‰ ê³„ì¸µì´ í•˜ë‚˜ ì´ìƒì¸ ê²½ìš°ì— ëŒ€í•œ ë™ì‘ í…ŒìŠ¤íŠ¸
# set_hidden([5,3])
# forward_neuralnet(x=[1,2,3])
# backprop_neuralnet(G_output=0, hiddens=[0])

# # ì€ë‹‰ ê³„ì¸µì´ í•˜ë‚˜ì¸ ê²½ìš°ì— ëŒ€í•œ ë™ì‘ í…ŒìŠ¤íŠ¸
# set_hidden(5)
# forward_neuralnet(x=[1,2,3])
# backprop_neuralnet(G_output=0, hiddens=[0])

# ê³„ì¸µ ì‚¬ì´ì˜ íŒŒë¼ë¯¸í„° ì´ˆê¸°í™”ë¥¼ ì§„í–‰í•˜ëŠ” ë©”ì„œë“œ
# shape : ë‹¤ìŒê³¼ ê°™ì€ ë¦¬ìŠ¤íŠ¸ í˜•ì‹ìœ¼ë¡œ ê°’ì„ ì „ë‹¬ë°›ìŠµë‹ˆë‹¤. 
# ex) ë…ë¦½ë³€ìˆ˜ 5ê°œ, ì€ë‹‰ê³„ì¸µì˜ ë…¸ë“œ 3ê°œì¸ ê²½ìš° [5,3]
# ex) ì€ë‹‰ê³„ì¸µì˜ ë…¸ë“œ ìˆ˜ 3ê°œ, ì¶œë ¥ê³„ì¸µì˜ ë…¸ë“œ ìˆ˜ 1ê°œì¸ ê²½ìš° [3,1]
def allocate_param_pair(shape):
    # [ê°€ì¤‘ì¹˜ ì´ˆê¸°í™” ê³¼ì •]
    weight = np.random.normal(RND_MEAN, RND_STD, shape)
		
	# [í¸í–¥ ì´ˆê¸°í™” ê³¼ì •]
    # í¸í–¥ì€ ë¦¬ìŠ¤íŠ¸ í˜•ì‹ìœ¼ë¡œ ê°’ì„ ì „ë‹¬ë°›ëŠ” ê²ƒì„ ê³ ë ¤í•˜ì—¬ -1 ì¸ë±ìŠ¤ë¥¼ í™œìš© 
    bias   = np.zeros(shape[-1])
    
    # íŒŒì´ì¬ì˜ ë°ì´í„° íƒ€ì… ì¤‘ ë”•ì…”ë„ˆë¦¬ êµ¬ì¡°ë¡œ ì •ì˜í•©ë‹ˆë‹¤.
	# ê°€ì¤‘ì¹˜ëŠ” 'w', í¸í–¥ì€ 'b' í‚¤ë¡œ ì ‘ê·¼í•˜ì—¬ í™œìš©í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤. 
    return {'w':weight, 'b':bias}

# # [í…ŒìŠ¤íŠ¸ ì½”ë“œ]
# import numpy as np
# RND_MEAN, RND_STD = 0.0, 1.0

# # ì…ë ¥ ë²¡í„°ì˜ ë…¸ë“œ ìˆ˜ 5ê°œ, ì€ë‹‰ ê³„ì¸µì˜ ë…¸ë“œ ìˆ˜ 3ê°œ ì¸ ê²½ìš° í•´ë‹¹ ê³„ì¸µ ì‚¬ì´ì— ì¡´ì¬í•˜ëŠ” íŒŒë¼ë¯¸í„°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. 
# # ê°€ì¤‘ì¹˜ 15ê°œ, í¸í–¥ 3ê°œ
# pm_hidden = allocate_param_pair([5,3])

# print("pm_hidden['w'] : \n", pm_hidden['w'])
# print("pm_hidden['b'] : \n", pm_hidden['b'])

# í•˜ë‚˜ì˜ ì€ë‹‰ê³„ì¸µì„ ê°–ëŠ” ì‹ ê²½ë§ì˜ íŒŒë¼ë¯¸í„°ë³€ìˆ˜ ìƒì„± ë©”ì„œë“œ
def init_param_hidden1():

    # ì¶”í›„ í™œìš©ì„ ìœ„í•œ ì „ì—­ë³€ìˆ˜ ì§€ì • 
    global pm_output, pm_hidden, input_cnt, output_cnt, hidden_cnt
    # input_cnt  : ì‚¬ì „ ì‹ ê²½ë§ ëª¨ë¸ì´ ë“¤ì–´ìˆëŠ” íŒŒì¼ì— ì •ì˜ëœ ì…ë ¥ ê³„ì¸µì˜ ë…¸ë“œ ìˆ˜ (ë…ë¦½ë³€ìˆ˜ì˜ ìˆ˜)
	# output_cnt : ì‚¬ì „ ì‹ ê²½ë§ ëª¨ë¸ì´ ë“¤ì–´ìˆëŠ” íŒŒì¼ì— ì •ì˜ëœ ì¶œë ¥ ê³„ì¸µì˜ ë…¸ë“œ ìˆ˜ (ì¢…ì†ë³€ìˆ˜ì˜ ìˆ˜) 
    # pm_hidden : ì…ë ¥ê³„ì¸µê³¼ ì€ë‹‰ê³„ì¸µ ì‚¬ì´ì— ì¡´ì¬í•˜ëŠ” íŒŒë¼ë¯¸í„° 
    # pm_output : ì€ë‹‰ê³„ì¸µê³¼ ì¶œë ¥ê³„ì¸µ ì‚¬ì´ì— ì¡´ì¬í•˜ëŠ” íŒŒë¼ë¯¸í„°
	
	# ì‚¬ì „ì— ì •ì˜í•œ allocate_param_pair() ë©”ì„œë“œë¥¼ í†µí•´ ê³„ì¸µê³¼ ê³„ì¸µì‚¬ì´ì˜ íŒŒë¼ë¯¸í„°ê°€ ë‹´ê¸´ ë³€ìˆ˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    pm_hidden = allocate_param_pair([input_cnt, hidden_cnt])
    pm_output = allocate_param_pair([hidden_cnt, output_cnt])

# # [í…ŒìŠ¤íŠ¸ ì½”ë“œ]
# # ë‹¤ì¸µ í¼ì…‰íŠ¸ë¡  ì‹ ê²½ë§ êµ¬ì¡° ì„¤ì •
# input_cnt = 10  # ì…ë ¥ê³„ì¸µì˜ ë…¸ë“œ ìˆ˜ 10ê°œ 
# set_hidden(5)   # ì€ë‹‰ê³„ì¸µì˜ ë…¸ë“œ ìˆ˜ 5ê°œ
# output_cnt = 1  # ì¶œë ¥ê³„ì¸µì˜ ë…¸ë“œ ìˆ˜ 1ê°œ 

# # íŒŒë¼ë¯¸í„° ì´ˆê¸°í™” ë©”ì„œë“œ ë™ì‘ ì‹œë‚˜ë¦¬ì˜¤
# # init_param() -> init_param_hidden1() -> allocate_param_pair()
# init_param()

# print("pm_hidden['w'] : \n", pm_hidden['w'])
# print("pm_hidden['b'] : \n", pm_hidden['b'])
# print("pm_output['w'] : \n", pm_output['w'])
# print("pm_output['b'] : \n", pm_output['b'])

# ë‹¤ìˆ˜ì˜ ì€ë‹‰ê³„ì¸µì´ ìˆëŠ” ê²½ìš° ê° ê³„ì¸µ ì‚¬ì´ì— ì¡´ì¬í•˜ëŠ” íŒŒë¼ë¯¸í„° ë³€ìˆ˜ ìƒì„± ë©”ì„œë“œ
def init_param_hiddens():
    # input_cnt    : ì…ë ¥ê³„ì¸µì˜ ë…¸ë“œ ìˆ˜
    # output_cnt   : ì¶œë ¥ê³„ì¸µì˜ ë…¸ë“œ ìˆ˜ 
    # hidden_config : ì€ë‹‰ê³„ì¸µì— ëŒ€í•œ ì •ë³´ 
    # pm_hiddens: [ì…ë ¥ê³„ì¸µ]-> (íŒŒë¼ë¯¸í„°{pm_hiddens}) ->[ì€ë‹‰ê³„ì¸µ]--> (íŒŒë¼ë¯¸í„°{pm_hiddens}) -->[ë§ˆì§€ë§‰ ì€ë‹‰ê³„ì¸µ]--> ...
    # pm_output : [ë§ˆì§€ë§‰ ì€ë‹‰ê³„ì¸µ]-> (íŒŒë¼ë¯¸í„°{pm_output}) ->[ì¶œë ¥ê³„ì¸µ]
    global pm_output, pm_hiddens, input_cnt, output_cnt, hidden_config

    # ì…ë ¥ê³„ì¸µë¶€í„° ë§ˆì§€ë§‰ ì€ë‹‰ê³„ì¸µ ì‚¬ì´ì— ì¡´ì¬í•˜ëŠ” íŒŒë¼ë¯¸í„° ê°’ì„ ì €ì¥í•˜ê¸° ìœ„í•œ ë¹ˆë¦¬ìŠ¤íŠ¸ ì‚¬ì „ ì •ì˜ 
    # ë§ˆì§€ë§‰ ì€ë‹‰ê³„ì¸µê³¼ ì¶œë ¥ ê³„ì¸µ ì‚¬ì´ì˜ íŒŒë¼ë¯¸í„°ëŠ” ë”°ë¡œ ë³€ìˆ˜ë¥¼ ë‘˜ ì˜ˆì • 
    pm_hiddens = []

    # ë°˜ë³µë¬¸ì„ í™œìš©í•˜ì—¬ íŒŒë¼ë¯¸í„°ë¥¼ ìƒì„±í•  ì˜ˆì •ì´ê¸°ì— input_cnt ë³€ìˆ˜ì˜ ê°’ì„
    # prev_cnt ë³€ìˆ˜ì— í• ë‹¹í•©ë‹ˆë‹¤. 
    prev_cnt = input_cnt

    # hidden_config:list -> ì€ë‹‰ê³„ì¸µì˜ ìˆ˜ì™€ í­ ì •ë³´
    # Ex) 6, [3,7], [3,6,9], ...
    for hidden_cnt in hidden_config:
        
        # ì…ë ¥ê³„ì¸µ(prev_cnt)ê³¼ ì²«ë²ˆì§¸ ì€ë‹‰ê³„ì¸µ(hidden_cnt)ì˜ íŒŒë¼ë¯¸í„° ìƒì„±
        # í•´ë‹¹ ê³„ì¸µ ì‚¬ì´ì˜ íŒŒë¼ë¯¸í„°ëŠ” pm_hiddens ë³€ìˆ˜ì— ìŒ“ëŠ”ë‹¤. 
        pm_hiddens.append(allocate_param_pair([prev_cnt, hidden_cnt]))
        
        # ì€ë‹‰ ê³„ì¸µì˜ ë…¸ë“œ ìˆ˜ ì •ë³´ë¥¼ prev_cnt ë³€ìˆ˜ë¡œ í• ë‹¹í•˜ì—¬ allocate_param_pair()ë¥¼ í†µí•´
        # ë‹¤ì‹œ ì€ë‹‰ ê³„ì¸µë“¤ ì‚¬ì´ì˜ íŒŒë¼ë¯¸í„° ë³€ìˆ˜ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤. 
        prev_cnt = hidden_cnt
        # ëª¨ë“  ì€ë‹‰ê³„ì¸µë“¤ì˜ íŒŒë¼ë¯¸í„° ìƒì„±ì„ ë§ˆì¹˜ë©´ ë°˜ë³µë¬¸ íƒˆì¶œ

    # ë§ˆì§€ë§‰ ì€ë‹‰ê³„ì¸µ(prev_cnt)ê³¼ ì¶œë ¥ê³„ì¸µ(output_cnt) ì‚¬ì´ì˜ íŒŒë¼ë¯¸í„° ìƒì„± ë° ë³€ìˆ˜ ìƒì„±  
    pm_output = allocate_param_pair([prev_cnt, output_cnt])

# # [í…ŒìŠ¤íŠ¸ ì½”ë“œ]
# # ë‹¤ì¸µ í¼ì…‰íŠ¸ë¡  ì‹ ê²½ë§ êµ¬ì¡° ì„¤ì •
# input_cnt = 10    # ì…ë ¥ê³„ì¸µì˜ ë…¸ë“œ ìˆ˜ 10ê°œ 
# set_hidden([5,3]) # ì€ë‹‰ê³„ì¸µë“¤ì˜ ë…¸ë“œ ìˆ˜ ê° 5ê°œ, 3ê°œ
# output_cnt = 1    # ì¶œë ¥ê³„ì¸µì˜ ë…¸ë“œ ìˆ˜ 1ê°œ 

# # íŒŒë¼ë¯¸í„° ì´ˆê¸°í™” ë©”ì„œë“œ ë™ì‘ ì‹œë‚˜ë¦¬ì˜¤
# # init_param() -> init_param_hiddens() -> allocate_param_pair()
# init_param()

# print("ì…ë ¥ê³„ì¸µê³¼ ì²« ë²ˆì§¸ ì€ë‹‰ê³„ì¸µ ì‚¬ì´ì˜ ê°€ì¤‘ì¹˜ : \n", pm_hiddens[0]['w'])
# print("ì…ë ¥ê³„ì¸µê³¼ ì²« ë²ˆì§¸ ì€ë‹‰ê³„ì¸µ ì‚¬ì´ì˜ í¸í–¥ : \n", pm_hiddens[0]['b'])
# print("ì²« ë²ˆì§¸ ì€ë‹‰ê³„ì¸µê³¼ ë‘ ë²ˆì§¸ ì€ë‹‰ê³„ì¸µ ì‚¬ì´ì˜ ê°€ì¤‘ì¹˜ : \n", pm_hiddens[1]['w'])
# print("ì²« ë²ˆì§¸ ì€ë‹‰ê³„ì¸µê³¼ ë‘ ë²ˆì§¸ ì€ë‹‰ê³„ì¸µ ì‚¬ì´ì˜ í¸í–¥ : \n", pm_hiddens[1]['b'])
# print("ë‘ ë²ˆì§¸ ì€ë‹‰ê³„ì¸µê³¼ ì¶œë ¥ê³„ì¸µ ì‚¬ì´ì˜ ê°€ì¤‘ì¹˜ : \n", pm_output['w'])
# print("ë‘ ë²ˆì§¸ ì€ë‹‰ê³„ì¸µê³¼ ì¶œë ¥ê³„ì¸µ ì‚¬ì´ì˜ í¸í–¥ : \n", pm_output['b'])

# í™œì„±í™” í•¨ìˆ˜ ReLU() ì •ì˜ 
def relu(x):
    # ìŒìˆ˜ì™€ 0ì„ ê±¸ëŸ¬ì£¼ëŠ” numpy ë‚´ë¶€ ë©”ì„œë“œ í™œìš© 
    return np.maximum(x,0)

# # [í…ŒìŠ¤íŠ¸ ì½”ë“œ]
# for x in range(-3,4,1):
#     print(f"relu({x}) : {relu(x)}")

# ìˆœì „íŒŒë¥¼ ìˆ˜í–‰í•˜ëŠ” ë©”ì„œë“œ ì •ì˜
def forward_neuralnet_hidden1(x):

    global pm_output, pm_hidden
    
    # hidden : ì€ë‹‰ê³„ì¸µì˜ ê° ë…¸ë“œê°€ ê°–ëŠ” ê°’
    # ì€ë‹‰ê³„ì¸µì˜ ê°€ì¤‘ì¹˜ì™€ í¸í–¥ì„ í™œìš©í•´ ë…ë¦½ë³€ìˆ˜ì™€ì˜ ì—°ì‚° í›„ ë¹„ì„ í˜• í™œì„±í™” í•¨ìˆ˜ relu() ì ìš©
    hidden = relu(np.matmul(x, pm_hidden['w']) + pm_hidden['b'])

    # output : ì¶œë ¥ê³„ì¸µì˜ ê° ë…¸ë“œê°€ ê°–ëŠ” ê°’ 
    # ì¶œë ¥ ê³„ì¸µì— ëŒ€í•œ ì„ í˜• ì—°ì‚°
    output = np.matmul(hidden, pm_output['w']) + pm_output['b']

    # ë°˜í™˜ë˜ì–´ì§€ëŠ” ê°’ì€ ìµœì¢… ì—°ì‚° ê²°ê´ê°’ê³¼ ì—­ì „íŒŒì— í™œìš©ë˜ëŠ” ê° ê³„ì¸µë³„ ë³€ìˆ˜ 
    return output, [x,hidden]

# # [í…ŒìŠ¤íŠ¸ ì½”ë“œ]
# # ë”ë¯¸ë°ì´í„° ìƒì„±
# x = np.asarray([1.23, 0.31, 2.31])
# # ë”ë¯¸ë°ì´í„°ì— ë”°ë¥¸ ì‹ ê²½ë§ ë…¸êµ¬ì¡° ê²°ì •
# input_cnt = 3  
# set_hidden(2)
# output_cnt = 1

# # íŒŒë¼ë¯¸í„° ì´ˆê¸°í™” ë©”ì„œë“œ ë™ì‘
# init_param()
# # ìˆœì „íŒŒ ì—°ì‚° ë©”ì„œë“œ ë™ì‘ 
# result = forward_neuralnet(x)

# print("ìˆœì „íŒŒ ì—°ì‚° ê²°ê´ê°’(output) : ", result[0])
# print("ìˆœì „íŒŒ ì¤‘ê°„ì—°ì‚° ê²°ê´ê°’(hidden) : ", result[1][1])
# print("ë…ë¦½ë³€ìˆ˜(x) : ", result[1][0])

# í•˜ë‚˜ ì´ìƒì˜ ì€ë‹‰ê³„ì¸µì´ ì¡´ì¬í•˜ëŠ” ê²½ìš° ìˆœì „íŒŒ ë©”ì„œë“œ ì •ì˜
# x : ë…ë¦½ë³€ìˆ˜
def forward_neuralnet_hiddens(x):
    # pm_hiddens : ì…ë ¥ê³„ì¸µê³¼ ì€ë‹‰ê³„ì¸µë“¤ ì‚¬ì´ì˜ íŒŒë¼ë¯¸í„°(ë¦¬ìŠ¤íŠ¸, ë”•ì…”ë„ˆë¦¬)
    # pm_output  : ë§ˆì§€ë§‰ ì€ë‹‰ê³„ì¸µê³¼ ì¶œë ¥ê³„ì¸µ ì‚¬ì´ì˜ íŒŒë¼ë¯¸í„°(ë”•ì…”ë„ˆë¦¬)
    global pm_output, pm_hiddens

    # ì…ë ¥ê³„ì¸µì˜ ë°ì´í„°(ë…ë¦½ë³€ìˆ˜)
    hidden = x    # ì—°ì‚°ìš©
    hiddens = [x] # ì—­ì „íŒŒ ì „ë‹¬ìš© ë³´ì¡°ì •ë³´(ê¸°ì¡´ê°’ í¬í•¨)

    # ë°˜ë³µë¬¸ì„ í†µí•´ ì€ë‹‰ê³„ì¸µë“¤ì˜ íŒŒë¼ë¯¸í„° ì •ë³´ë¥¼ í•˜ë‚˜ì”© ì „ë‹¬ë°›ë„ë¡ í•¨ 
    # ì…ë ¥ê³„ì¸µë¶€í„° ë§ˆì§€ë§‰ ì€ë‹‰ê³„ì¸µê¹Œì§€ì˜ ì—°ì‚°ì„ ì§„í–‰
    # ì„ í˜•ì—°ì‚° ê²°ê´ê°’ ë‹¤ìŒì€ relu ì ìš© 
    for pm_hidden in pm_hiddens:

        hidden = relu(np.matmul(hidden, pm_hidden['w']) + pm_hidden['b'])
        # ì—°ì‚° ê²°ê´ê°’ì˜ í• ë‹¹
        hiddens.append(hidden)

    # ë§ˆì§€ë§‰ ì€ë‹‰ê³„ì¸µê¹Œì§€ì˜ ì—°ì‚°ê²°ê´ê°’ê³¼ ì¶œë ¥ê³„ì¸µì˜ íŒŒë¼ë¯¸í„°ì˜ ì—°ì‚°
    # í™œì„±í™” í•¨ìˆ˜ ì ìš© X
    output = np.matmul(hidden, pm_output['w']) + pm_output['b']

    # ì—°ì‚° ê²°ê´ê°’(output) ë°˜í™˜ ë° ê²½ì‚¬í•˜ê°•ë²• ì ìš©ì„ ìœ„í•´ hiddens ë°˜í™˜ 
    return output, hiddens

# # í…ŒìŠ¤íŠ¸ ì½”ë“œ
# # ë”ë¯¸ë°ì´í„° ìƒì„±
# x = np.asarray([1.23, 0.31, 2.31, 0.3, 2.13])
# # ë”ë¯¸ë°ì´í„°ì— ë”°ë¥¸ ì‹ ê²½ë§ ë…¸êµ¬ì¡° ê²°ì •
# input_cnt = 5  
# set_hidden([3,2])
# output_cnt = 1

# # íŒŒë¼ë¯¸í„° ì´ˆê¸°í™” ë©”ì„œë“œ ë™ì‘
# init_param()
# # ìˆœì „íŒŒ ì—°ì‚° ë©”ì„œë“œ ë™ì‘ 
# result = forward_neuralnet(x)

# print("ë…ë¦½ë³€ìˆ˜(x) : ", result[1][0])
# print("ì²« ë²ˆì§¸ ì€ë‹‰ê³„ì¸µ ì—°ì‚° ê²°ê´ê°’(hiddens) : ", result[1][1])
# print("ë‘ ë²ˆì§¸ ì€ë‹‰ê³„ì¸µ ì—°ì‚° ê²°ê´ê°’(hiddens) : ", result[1][2])
# print("ìˆœì „íŒŒ ì—°ì‚° ê²°ê´ê°’(output) : ", result[0])

# í™œì„±í™” í•¨ìˆ˜ ReLU ëŠ” np.sign() ë©”ì„œë“œë¡œ êµ¬í˜„í•  ìˆ˜ ìˆìœ¼ë©°, ë‹¤ìŒê³¼ ê°™ì€ íŠ¹ì§•ì„ ê°–ìŠµë‹ˆë‹¤. 
# -1 if x < 0
# 0 if x==0
# 1 if x > 0
def relu_derv(y):
    return np.sign(y)

# íŒŒë¼ë¯¸í„° ê°±ì‹ ì„ ìˆ˜í–‰í•˜ëŠ” ë©”ì„œë“œ 
# G_output : ì¶œë ¥ê³„ì¸µê³¼ ì€ë‹‰ê³„ì¸µ ì‚¬ì´ì˜ âˆ‚L/âˆ‚Y
# aux : ì…ë ¥ ë²¡í„°, ì€ë‹‰ ê³„ì¸µì˜ ì •ë³´ 
def backprop_neuralnet_hidden1(G_output, aux):
    
    # pm_hidden : ì…ë ¥ê³„ì¸µê³¼ ì€ë‹‰ê³„ì¸µ ì‚¬ì´ì˜ íŒŒë¼ë¯¸í„°
    # pm_output : ì€ë‹‰ê³„ì¸µê³¼ ì¶œë ¥ê³„ì¸µ ì‚¬ì´ì˜ íŒŒë¼ë¯¸í„°    
    global pm_output, pm_hidden
    
    # ì…ë ¥ ë²¡í„°, ì€ë‹‰ê³„ì¸µì˜ ë…¸ë“œ ê°’ ê°ê° ë³€ìˆ˜í™” 
    x, hidden = aux

    # [ì¶œë ¥ê³„ì¸µê³¼ ì€ë‹‰ê³„ì¸µ ì‚¬ì´ì˜ íŒŒë¼ë¯¸í„° ê°±ì‹  ì¤€ë¹„ê³¼ì •]
    # ê°€ì¤‘ì¹˜ ê°±ì‹  ì¤€ë¹„ê³¼ì • : X^t * G
    g_output_w_output = hidden.transpose()
    G_w_out = np.matmul(g_output_w_output, G_output)
    # í¸í–¥ ê°±ì‹  ì¤€ë¹„ê³¼ì • : G
    G_b_out = np.sum(G_output, axis = 0)

    # [G_hidden ìƒì„±ê³¼ì • 1ë‹¨ê³„] 
    # G_Hidden : ì€ë‹‰ê³„ì¸µê³¼ ì…ë ¥ê³„ì¸µ ì‚¬ì´ì˜ âˆ‚L/âˆ‚Y
    # ì „ì²´ ìˆ˜ì‹ : (ğ›…_k * w_k) * ğœ‘(h)
    # 1ë‹¨ê³„ì—ì„œ êµ¬í˜„í•˜ëŠ” ìˆ˜ì‹ : (ğ›…_k * w_k)
     
    # np.matmul() ì—°ì‚° ê³¼ì •ì„ ìœ„í•´ í–‰ë ¬ì „í™˜
    # G_hidden ì„ êµ¬í•˜ê¸° ìœ„í•´ì„œëŠ” ì—…ë°ì´íŠ¸ê°€ ë˜ì§€ ì•Šì€ ê°€ì¤‘ì¹˜ê°€ í•„ìš”í•˜ê¸°ì— 
    # ê°€ì¤‘ì¹˜ ì—…ë°ì´íŠ¸ ì „ì— í™œìš©
    g_output_hidden = pm_output['w'].transpose()
    G_hidden = np.matmul(G_output, g_output_hidden)

    # ì¶œë ¥ê³„ì¸µê³¼ ì€ë‹‰ê³„ì¸µ ì‚¬ì´ì˜ íŒŒë¼ë¯¸í„° ê°±ì‹ 
    pm_output['w'] -= LEARNING_RATE * G_w_out
    pm_output['b'] -= LEARNING_RATE * G_b_out


    # [G_hidden ìƒì„±ê³¼ì • 2ë‹¨ê³„] 
    # G_Hidden : ì€ë‹‰ê³„ì¸µê³¼ ì…ë ¥ê³„ì¸µ ì‚¬ì´ì˜ â‚©
    # ì „ì²´ ìˆ˜ì‹ : (ğ›…_k * w_k) * ğœ‘(h)
    # 2ë‹¨ê³„ì—ì„œ êµ¬í˜„í•˜ëŠ” ìˆ˜ì‹ : (ğ›…_k * w_k) * ğœ‘(h)
    # ì€ë‹‰ê³„ì¸µì—ì„œ ë¹„ì„ í˜• í™œì„±í™”í•¨ìˆ˜ reluê°€ ì‚¬ìš©ë˜ë¯€ë¡œ, ì´ì— ë”°ë¥¸ ë¯¸ë¶„ê³¼ì •ì˜ ê³±ì´ ìˆ˜í–‰ 
    G_hidden = G_hidden * relu_derv(hidden)

    # ì€ë‹‰ê³„ì¸µê³¼ ì…ë ¥ê³„ì¸µ ì‚¬ì´ì˜ íŒŒë¼ë¯¸í„° ê°±ì‹ ì¤€ë¹„ê³¼ì •
    # ê°€ì¤‘ì¹˜ ê°±ì‹  ì¤€ë¹„ê³¼ì •
    g_hidden_w_hid = x.transpose()
    G_w_hid = np.matmul(g_hidden_w_hid, G_hidden)
    # í¸í–¥ ê°±ì‹  ì¤€ë¹„ê³¼ì •
    G_b_hid = np.sum(G_hidden, axis=0)

    # ì€ë‹‰ê³„ì¸µê³¼ ì…ë ¥ê³„ì¸µ ì‚¬ì´ì˜ íŒŒë¦¬ë¯¸í„° ê°±ì‹  
    pm_hidden['w'] -= LEARNING_RATE * G_w_hid
    pm_hidden['b'] -= LEARNING_RATE * G_b_hid

# íŒŒë¼ë¯¸í„° ì—…ë°ì´íŠ¸ ë§¤ì„œë“œ 
# G_output : ê°€ì¥ ë§ˆì§€ë§‰ ê³„ì¸µì˜ âˆ‚L/âˆ‚Y (delta_k)
# aux : ë…ë¦½ë³€ìˆ˜, ì€ë‹‰ê³„ì¸µë“¤ì´ ê°–ëŠ” ë…¸ë“œ ê°’ 
def backprop_neuralnet_hiddens(G_output, aux):
    global pm_output, pm_hiddens

    # ë…ë¦½ë³€ìˆ˜ì™€ ì€ë‹‰ê³„ì¸µë“¤ì˜ ë…¸ë“œê°’ë“¤ì„ hiddens ì— ì €ì¥(ë¦¬ìŠ¤íŠ¸ íƒ€ì…)
    hiddens = aux 

    # [ì¶œë ¥ê³„ì¸µê³¼ ë§ˆì§€ë§‰ ì€ë‹‰ê³„ì¸µ ì‚¬ì´ì˜ íŒŒë¼ë¯¸í„° ê°±ì‹  ì¤€ë¹„]
    # ê°€ì¤‘ì¹˜ ê°±ì‹ ì— í•„ìš”í•œ ìˆ˜ì‹ : âˆ‚L/âˆ‚W (X^t * G)
    # ê°€ì¥ ë§ˆì§€ë§‰ ì€ë‹‰ ê³„ì¸µ(hiddens[-1])ì˜ í–‰ë ¬ì „í™˜ 
    g_output_w_out = hiddens[-1].transpose()
    G_w_out = np.matmul(g_output_w_out, G_output)
    # í¸í–¥ ê°±ì‹ ì— í•„ìš”í•œ ìˆ˜ì‹ : âˆ‚L/âˆ‚B (G)
    G_b_out = np.sum(G_output, axis = 0)

    # [ë§ˆì§€ë§‰ ì€ë‹‰ê³„ì¸µê³¼ ì´ì „ ì€ë‹‰ê³„ì¸µì˜ âˆ‚L/âˆ‚Y (delta_k+1) ì¤€ë¹„ - 1/2 ë‹¨ê³„]
    # ì—…ë°ì´íŠ¸ê°€ ë˜ì§€ ì•Šì€ ê°€ì¤‘ì¹˜ê°€ í•„ìš” 
    g_output_hidden = pm_output['w'].transpose()
    G_hidden = np.matmul(G_output, g_output_hidden)

    # [ì¶œë ¥ê³„ì¸µê³¼ ë§ˆì§€ë§‰ ì€ë‹‰ê³„ì¸µ ì‚¬ì´ì˜ íŒŒë¼ë¯¸í„° ê°±ì‹ ]
    # ì¶œë ¥ê³„ì¸µê³¼ ë§ˆì§€ë§‰ ì€ë‹‰ê³„ì¸µì˜ íŒŒë¼ë¯¸í„° ì—…ë°ì´íŠ¸
    pm_output['w'] -= LEARNING_RATE * G_w_out
    pm_output['b'] -= LEARNING_RATE * G_b_out

    # ë§ˆì§€ë§‰ ì€ë‹‰ ê³„ì¸µê³¼ ê·¸ ì´ì „ ê³„ì¸µë“¤ ì‚¬ì´ì˜ íŒŒë¼ë¯¸í„° ì—…ë°ì´íŠ¸ ê³¼ì •
    # ì¦‰ ë’¤ì—ì„œ ë¶€í„° ì—…ë°ì´íŠ¸ë¥¼ í•˜ê¸° ìœ„í•´ reversed() ë¥¼ í™œìš©
    # reversed() : ì£¼ì–´ì§„ ê°’ë“¤ì„ ê±°ê¾¸ë¡œ ë°˜í™˜
    # pm_hiddens : ì…ë ¥ë²¡í„° ë¶€í„° ë§ˆì§€ë§‰ ì€ë‹‰ê³„ì¸µì˜ ê°’ì„ ë‹´ê³  ìˆìŒ (ë¦¬ìŠ¤íŠ¸)
    for n in reversed(range(len(pm_hiddens))):
        
        # [ë§ˆì§€ë§‰ ì€ë‹‰ê³„ì¸µê³¼ ì´ì „ ì€ë‹‰ê³„ì¸µì˜ âˆ‚L/âˆ‚Y (delta_k+1) ì¤€ë¹„ - 2/2ë‹¨ê³„]
        # 2ë‹¨ê³„ì—ì„œ êµ¬í˜„í•˜ëŠ” ìˆ˜ì‹ : (ğ›…_k * w_k) * ğœ‘(h)
        # ğœ‘(h)ì— ë§¤ê°œë³€ìˆ˜ëŠ” ê°€ì¥ ë§ˆì§€ë§‰ ì€ë‹‰ê³„ì¸µì˜ ê°’ë¶€í„° ìˆœì°¨ì ìœ¼ë¡œ ë“¤ì–´ì™€ì•¼í•¨
        G_hidden = G_hidden * relu_derv(hiddens[n+1])

        # ê°€ì¥ ë§ˆì§€ë§‰ ì´ì „ ê³„ì¸µì˜ íŒŒë¼ë¯¸í„° ê°±ì‹  ì¤€ë¹„
        g_hidden_w_hid = hiddens[n].transpose()
        G_w_hid = np.matmul(g_hidden_w_hid, G_hidden)
        G_b_hid = np.sum(G_hidden, axis = 0)

        # ë§ˆì§€ë§‰ ì€ë‹‰ê³„ì¸µì˜ ì´ì „ ê³„ì¸µ âˆ‚L/âˆ‚Y ì—°ì‚° (ğ›…_k * w_k)
        g_hidden_hidden = pm_hiddens[n]['w'].transpose()
        G_hidden = np.matmul(G_hidden, g_hidden_hidden)

        # ë§ˆì§€ë§‰ ì€ë‹‰ê³„ì¸µ ì´ì „ ê³„ì¸µì˜ íŒŒë¼ë¯¸í„° ê°±ì‹ 
        pm_hiddens[n]['w'] -= LEARNING_RATE * G_w_hid
        pm_hiddens[n]['b'] -= LEARNING_RATE * G_b_hid

